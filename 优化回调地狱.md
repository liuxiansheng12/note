
# 优化回调地狱

1. 借助的也是`then`的链型结构
   1) `$.ajax`返回的对象中，也有`then`函数，注册回调函数
   2) 并且then，返回一个新的对象
      1) 这样就可以利用`then`返回对象中的`then`，给新环境注册回调函数
      2) 这样就形成了`then`的链式调用
   3) 新环境的回调函数，触发条件有两种情况
      1) 前一个环境状态的回调函数执行时没有报错，新环境触发成功状态的回调函数
      2) 前一个环境状态的回调函数执行时报错，新环境触发失败状态的回调函数
      3) 前一个环境状态的回调函数执行时返回了一个环境对象
         1) 则，新环境中注册的回调函数，受返回环境对象的状态控制


2. 代码示范
```js
// 涉及到了三个环境的回调
$.ajax({
    url: "http://127.0.0.1:10086/a",
    type: "GET"
}).then((d) => {
    console.log(d);
    const de = $.Deferred();
    document.querySelector(".a").onclick = () => {
        de.resolve();
    }
    return de;
}).then((d) => {
    return $.ajax({
        url: "http://127.0.0.1:10086/b",
        type: "POST"
    })
}).then((d) => {
    console.log(d);
})
```


