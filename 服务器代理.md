
# 作用

1. 服务器代理，是解决跨域的一种方法



# 服务端代理

1. 需要下载一个包，用来发送一个请求，进行数据的获取
   1) 下载方式: `npm i request -D `;


2. 具体的代理代码
```js
let http = require("http");
let req = require("request");

http.createServer( (request, response) => {
    // 向另一个服务器发送请求
    req({
        url: "请求的url地址",
        method: "POST",    // 请求方式
        headers: {
            // 发送的数据为json格式(没有要求可以不写)
            "content-type": "application/json"
        },
        // 发送的数据(只适用post请求)
        body: {a: 123}
    }, (err, resp, body) => {
        if(err) {
            console.log(err);       // 打印出错误
        }else {
            console.log(123);       // body为请求回来的数据
            response.writeHead(200);
            response.write(body);
            response.end();
        }
    } );
}).listen(9595, "192.168.31.76");
```


3. 如果路径中有中文，在请求的过程中可能会发送错误，所以需要使用一种方法进行转换一下
   1) `encodeURI(url)`
   2) 具体的示范代码
   ```js
   dai( encodeURI("http://www.kuwo.cn/a?a='中文'"), (data) => {} );
   // 服务器代理的方法
   function dai(url, callBack) {
       req({
           url: url,
           headers: {
               "csrf": "YK6NOX2MAU", 
               "Cookie": "kw_token=YK6NOX2MAU",
           }
       }, (err, resp, body) => {
           if(err) {
               console.log(err);
               // 路径使用encodeURI进行转换后，会报一些错误问题，需要重新进行发送请求
               dai(url, callBack);
           }
           else {
               callBack(body);
           }
       } )
   }
   ```





# nodejs从远程服务器上下载文件

1. 借助的也是`request`包发送请求，获取文件数据，然后写入指定的文件中

2. 具体的示范代码
```js
const req = require("request");
const fs = require('fs');

// 建立对应的文件输入流
var stream = fs.createWriteStream("./static/ashfdoasdf.mp3");
req(url).pipe(stream).on('close', () => {
    // 写入文件完成后，的回调函数，即文件下载完成后的回调函数

    // 发送个前端，前端进行下载
    const data = fs.readFileSync("./static/ashfdoasdf.mp3");
    response.end(data);
} ); 
```
